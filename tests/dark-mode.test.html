<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dark Mode Tests</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .test-pass {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .test-fail {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .test-info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        #test-frame {
            width: 100%;
            height: 600px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>üåô Dark Mode Functionality Tests</h1>
    
    <div class="test-container">
        <h2>Test Environment</h2>
        <p>This test suite verifies that the dark mode toggle works correctly across the entire website.</p>
        <button onclick="runAllTests()">Run All Tests</button>
        <button onclick="clearResults()">Clear Results</button>
    </div>

    <div class="test-container">
        <h2>Test Results</h2>
        <div id="test-results"></div>
    </div>

    <div class="test-container">
        <h2>Live Test Frame</h2>
        <p>The application is loaded below for manual verification:</p>
        <iframe id="test-frame" src="../index.html"></iframe>
    </div>

    <script>
        let testResults = [];

        function logResult(testName, passed, message) {
            testResults.push({
                name: testName,
                passed: passed,
                message: message,
                timestamp: new Date().toLocaleTimeString()
            });
            updateResultsDisplay();
        }

        function updateResultsDisplay() {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = '';
            
            testResults.forEach(result => {
                const div = document.createElement('div');
                div.className = `test-result ${result.passed ? 'test-pass' : 'test-fail'}`;
                div.innerHTML = `
                    <strong>${result.passed ? '‚úÖ' : '‚ùå'} ${result.name}</strong><br>
                    ${result.message}<br>
                    <small>Time: ${result.timestamp}</small>
                `;
                resultsDiv.appendChild(div);
            });

            // Add summary
            const passed = testResults.filter(r => r.passed).length;
            const total = testResults.length;
            const summaryDiv = document.createElement('div');
            summaryDiv.className = `test-result ${passed === total ? 'test-pass' : 'test-info'}`;
            summaryDiv.innerHTML = `<strong>Summary: ${passed}/${total} tests passed</strong>`;
            resultsDiv.appendChild(summaryDiv);
        }

        function clearResults() {
            testResults = [];
            updateResultsDisplay();
        }

        async function runAllTests() {
            clearResults();
            
            logResult('Test Setup', true, 'Starting dark mode functionality tests...');
            
            // Wait for iframe to load
            const iframe = document.getElementById('test-frame');
            await new Promise(resolve => {
                if (iframe.contentDocument && iframe.contentDocument.readyState === 'complete') {
                    resolve();
                } else {
                    iframe.onload = resolve;
                }
            });

            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
            const iframeWindow = iframe.contentWindow;

            // Test 1: Check if theme toggle button exists
            const themeToggle = iframeDoc.getElementById('theme-toggle');
            logResult(
                'Theme Toggle Button Exists',
                !!themeToggle,
                themeToggle ? 'Theme toggle button found' : 'Theme toggle button not found'
            );

            if (!themeToggle) {
                logResult('Test Aborted', false, 'Cannot continue tests without theme toggle button');
                return;
            }

            // Test 2: Check initial theme state
            const initialTheme = iframeDoc.documentElement.getAttribute('data-theme') || 'light';
            logResult(
                'Initial Theme State',
                true,
                `Initial theme is: ${initialTheme}`
            );

            // Test 3: Check if CSS variables are defined
            const rootStyles = iframeWindow.getComputedStyle(iframeDoc.documentElement);
            const bgColor = rootStyles.getPropertyValue('--background-color').trim();
            const textColor = rootStyles.getPropertyValue('--text-color').trim();
            
            logResult(
                'CSS Variables Defined',
                bgColor && textColor,
                `Background color: ${bgColor}, Text color: ${textColor}`
            );

            // Test 4: Toggle to dark mode
            const initialIcon = iframeDoc.querySelector('.theme-icon').textContent;
            themeToggle.click();
            
            // Wait a bit for the change to take effect
            await new Promise(resolve => setTimeout(resolve, 100));
            
            const newTheme = iframeDoc.documentElement.getAttribute('data-theme');
            const newIcon = iframeDoc.querySelector('.theme-icon').textContent;
            
            logResult(
                'Toggle to Dark Mode',
                newTheme === 'dark' && newIcon !== initialIcon,
                `Theme changed to: ${newTheme}, Icon changed from ${initialIcon} to ${newIcon}`
            );

            // Test 5: Check dark mode colors are applied
            const darkRootStyles = iframeWindow.getComputedStyle(iframeDoc.documentElement);
            const darkBgColor = darkRootStyles.getPropertyValue('--background-color').trim();
            const darkTextColor = darkRootStyles.getPropertyValue('--text-color').trim();
            
            const isDarkBg = darkBgColor.includes('#111827') || darkBgColor.includes('rgb(17, 24, 39)');
            const isDarkText = darkTextColor.includes('#f9fafb') || darkTextColor.includes('rgb(249, 250, 251)');
            
            logResult(
                'Dark Mode Colors Applied',
                isDarkBg && isDarkText,
                `Dark background: ${darkBgColor}, Dark text: ${darkTextColor}`
            );

            // Test 6: Check body background color
            const bodyStyles = iframeWindow.getComputedStyle(iframeDoc.body);
            const bodyBgColor = bodyStyles.backgroundColor;
            const isBodyDark = bodyBgColor.includes('17, 24, 39') || bodyBgColor.includes('#111827');
            
            logResult(
                'Body Background Dark',
                isBodyDark,
                `Body background color: ${bodyBgColor}`
            );

            // Test 7: Toggle back to light mode
            themeToggle.click();
            await new Promise(resolve => setTimeout(resolve, 100));
            
            const lightTheme = iframeDoc.documentElement.getAttribute('data-theme');
            const lightIcon = iframeDoc.querySelector('.theme-icon').textContent;
            
            logResult(
                'Toggle Back to Light Mode',
                lightTheme === 'light' && lightIcon === initialIcon,
                `Theme changed back to: ${lightTheme}, Icon: ${lightIcon}`
            );

            // Test 8: Check light mode colors are restored
            const lightRootStyles = iframeWindow.getComputedStyle(iframeDoc.documentElement);
            const lightBgColor = lightRootStyles.getPropertyValue('--background-color').trim();
            const lightTextColor = lightRootStyles.getPropertyValue('--text-color').trim();
            
            const isLightBg = lightBgColor.includes('#ffffff') || lightBgColor.includes('rgb(255, 255, 255)');
            const isLightText = lightTextColor.includes('#1f2937') || lightTextColor.includes('rgb(31, 41, 55)');
            
            logResult(
                'Light Mode Colors Restored',
                isLightBg && isLightText,
                `Light background: ${lightBgColor}, Light text: ${lightTextColor}`
            );

            // Test 9: Check localStorage persistence
            const storedTheme = iframeWindow.localStorage.getItem('theme');
            logResult(
                'Theme Persistence',
                storedTheme === 'light',
                `Stored theme in localStorage: ${storedTheme}`
            );

            logResult('Test Complete', true, 'All dark mode functionality tests completed!');
        }

        // Auto-run tests when page loads
        window.addEventListener('load', () => {
            setTimeout(runAllTests, 1000);
        });
    </script>
</body>
</html>